**Role:** Senior .NET Security Auditor  
**Task:** Critical code review with remediation  
**Focus:**  
1. Security vulnerabilities (map to CWE)  
2. Code smells
3. Bugs  
4. Performance optimizations

**Output Format:**  
```json
{
  "findings": [
    {
      "type": "Security/Smell/Bug/Optimization/",
      "problem": "Concise description <15 words",
      "severity": "Critical/High/Medium/Low",
      "cwe": "CWE-XXX (if applicable)",
      "fix": "Compilable C# code replacement",
      "explanation": "1-sentence technical justification"
    }
  ]
}
```  
**Rules:**  
- If no issues found: return empty "findings" array  
- Never suggest non-existent NuGet packages  
- Prioritize .NET best practices  
- Assume enterprise-scale deployment context

**Code**:
```cs
public static string GetSignature(
        OAuthSignatureMethod    signatureMethod,
        OAuthSignatureTreatment signatureTreatment,
        string                  signatureBase,
        string?                 consumerSecret,
        string?                 tokenSecret = null
    ) {
        if (tokenSecret.IsEmpty()) tokenSecret       = string.Empty;
        if (consumerSecret.IsEmpty()) consumerSecret = string.Empty;
 
        var unencodedConsumerSecret = consumerSecret;
        consumerSecret = Uri.EscapeDataString(consumerSecret);
        tokenSecret    = Uri.EscapeDataString(tokenSecret);
 
        var signature = signatureMethod switch {
            HmacSha1   => GetHmacSignature(new HMACSHA1(), consumerSecret, tokenSecret, signatureBase),
            HmacSha256 => GetHmacSignature(new HMACSHA256(), consumerSecret, tokenSecret, signatureBase),
            RsaSha1    => GetRsaSignature(),
            PlainText  => $"{consumerSecret}&{tokenSecret}",
            _          => throw new NotImplementedException("Only HMAC-SHA1, HMAC-SHA256, and RSA-SHA1 are currently supported.")
        };
 
        var result = signatureTreatment == OAuthSignatureTreatment.Escaped
            ? UrlEncodeRelaxed(signature)
            : signature;
 
        return result;
    }
```


# Yandex
```json
{
    "findings": [
        {
            "type": "Security",
            "problem": "Null coalescing could prevent empty checks",
            "severity": "Medium",
            "cwe": "CWE-570",
            "fix": "var tokenSecret = tokenSecret ?? string.Empty;",
            "explanation": "Using null coalescing operator simplifies null handling and reduces code duplication"
        },
        {
            "type": "Security",
            "problem": "Plain text signature exposes secrets in URL",
            "severity": "Critical",
            "cwe": "CWE-319",
            "fix": "throw new NotSupportedException(\"Plain text signatures are insecure and not allowed\")",
            "explanation": "Plain text signatures can expose sensitive information in logs and network traffic"
        },
        {
            "type": "Smell",
            "problem": "Unused variable declaration",
            "severity": "Low",
            "cwe": null,
            "fix": "Remove unused variable declaration",
            "explanation": "Declaring unused variables increases cognitive load and maintenance complexity"
        },
        {
            "type": "Optimization",
            "problem": "Redundant string encoding",
            "severity": "Medium",
            "cwe": null,
            "fix": "string encodedConsumerSecret = Uri.EscapeDataString(consumerSecret ?? string.Empty);",
            "explanation": "Avoid modifying input parameters and combine null check with encoding"
        },
        {
            "type": "Security",
            "problem": "HMACSHA1 is deprecated algorithm",
            "severity": "High",
            "cwe": "CWE-327",
            "fix": "Replace HMACSHA1 with HMACSHA256 or stronger",
            "explanation": "HMACSHA1 is considered weak and should not be used in new code"
        }
    ]
}
```
# GigaChat
```json
{
  "findings": [
    {
      "type": "Security",
      "problem": "Unnecessary secret storage in memory",
      "severity": "Medium",
      "cwe": "CWE-311",
      "fix": "",
      "explanation": "Remove unnecessary variable that stores sensitive data."
    },
    {
      "type": "Security",
      "problem": "Information leakage through exception message",
      "severity": "Medium",
      "cwe": "CWE-209",
      "fix": "throw new InvalidOperationException(\"Unsupported signature method\");",
      "explanation": "Use a more generic error message to prevent information disclosure."
    },
    {
      "type": "Performance Optimization",
      "problem": "Inefficient encoding method usage",
      "severity": "Low",
      "cwe": "",
      "fix": "WebUtility.UrlEncode(consumerSecret);",
      "explanation": "Replace `Uri.EscapeDataString` with `WebUtility.UrlEncode` for better performance."
    },
    {
      "type": "Code Smell",
      "problem": "Magic constant comparison",
      "severity": "Low",
      "cwe": "",
      "fix": "signatureTreatment.Equals(OAuthSignatureTreatment.Escaped)",
      "explanation": "Use `.Equals()` instead of direct equality check for better readability and maintainability."
    }
  ]
}
```
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>CoreStreaming.cs</title>
  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>
<pre><code class = "cs">
<a name="ln1">#region License</a>
<a name="ln2"> </a>
<a name="ln3">/*</a>
<a name="ln4">    Adapted work from:</a>
<a name="ln5"> </a>
<a name="ln6">    DirectShowLib - Provide access to DirectShow interfaces via .NET</a>
<a name="ln7">    Copyright (C) 2007</a>
<a name="ln8">    http://sourceforge.net/projects/directshownet/</a>
<a name="ln9">    This library is free software; you can redistribute it and/or</a>
<a name="ln10">    modify it under the terms of the GNU Lesser General Public</a>
<a name="ln11">    License as published by the Free Software Foundation; either</a>
<a name="ln12">    version 2.1 of the License, or (at your option) any later version.</a>
<a name="ln13">    This library is distributed in the hope that it will be useful,</a>
<a name="ln14">    but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln15">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln16">    Lesser General Public License for more details.</a>
<a name="ln17">    You should have received a copy of the GNU Lesser General Public</a>
<a name="ln18">    License along with this library; if not, write to the Free Software</a>
<a name="ln19">    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</a>
<a name="ln20">*/</a>
<a name="ln21"> </a>
<a name="ln22">#endregion</a>
<a name="ln23"> </a>
<a name="ln24">using System;</a>
<a name="ln25">using System.Runtime.InteropServices;</a>
<a name="ln26">using System.Security;</a>
<a name="ln27">using System.Text;</a>
<a name="ln28"> </a>
<a name="ln29">namespace ScreenToGif.Webcam.DirectShow;</a>
<a name="ln30"> </a>
<a name="ln31">public class CoreStreaming</a>
<a name="ln32">{</a>
<a name="ln33">    [ComVisible(true), ComImport, Guid(&quot;56a86891-0ad4-11ce-b03a-0020af0ba770&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln34">    public interface IPin</a>
<a name="ln35">    {</a>
<a name="ln36">        [PreserveSig]</a>
<a name="ln37">        int Connect([In] IPin pReceivePin, [In, MarshalAs(UnmanagedType.LPStruct)] AmMediaType pmt);</a>
<a name="ln38"> </a>
<a name="ln39">        [PreserveSig]</a>
<a name="ln40">        int ReceiveConnection([In] IPin pReceivePin, [In, MarshalAs(UnmanagedType.LPStruct)] AmMediaType pmt);</a>
<a name="ln41"> </a>
<a name="ln42">        [PreserveSig]</a>
<a name="ln43">        int Disconnect();</a>
<a name="ln44"> </a>
<a name="ln45">        [PreserveSig]</a>
<a name="ln46">        int ConnectedTo([Out] out IPin ppPin);</a>
<a name="ln47"> </a>
<a name="ln48">        /// &lt;summary&gt;</a>
<a name="ln49">        /// Release returned parameter with DsUtils.FreeAMMediaType</a>
<a name="ln50">        /// &lt;/summary&gt;</a>
<a name="ln51">        [PreserveSig]</a>
<a name="ln52">        int ConnectionMediaType([Out, MarshalAs(UnmanagedType.LPStruct)] AmMediaType pmt);</a>
<a name="ln53"> </a>
<a name="ln54">        /// &lt;summary&gt;</a>
<a name="ln55">        /// Release returned parameter with DsUtils.FreePinInfo</a>
<a name="ln56">        /// &lt;/summary&gt;</a>
<a name="ln57">        [PreserveSig]</a>
<a name="ln58">        int QueryPinInfo([Out] out PinInfo pInfo);</a>
<a name="ln59"> </a>
<a name="ln60">        [PreserveSig]</a>
<a name="ln61">        int QueryDirection(out PinDirection pPinDir);</a>
<a name="ln62"> </a>
<a name="ln63">        [PreserveSig]</a>
<a name="ln64">        int QueryId([Out, MarshalAs(UnmanagedType.LPWStr)] out string id);</a>
<a name="ln65"> </a>
<a name="ln66">        [PreserveSig]</a>
<a name="ln67">        int QueryAccept([In, MarshalAs(UnmanagedType.LPStruct)] AmMediaType pmt);</a>
<a name="ln68"> </a>
<a name="ln69">        [PreserveSig]</a>
<a name="ln70">        int EnumMediaTypes([Out] out IEnumMediaTypes ppEnum);</a>
<a name="ln71"> </a>
<a name="ln72">        [PreserveSig]</a>
<a name="ln73">        int QueryInternalConnections([Out, MarshalAs(UnmanagedType.LPArray, SizeParamIndex = 1)] IPin[] ppPins, [In, Out] ref int nPin);</a>
<a name="ln74"> </a>
<a name="ln75">        [PreserveSig]</a>
<a name="ln76">        int EndOfStream();</a>
<a name="ln77"> </a>
<a name="ln78">        [PreserveSig]</a>
<a name="ln79">        int BeginFlush();</a>
<a name="ln80"> </a>
<a name="ln81">        [PreserveSig]</a>
<a name="ln82">        int EndFlush();</a>
<a name="ln83"> </a>
<a name="ln84">        [PreserveSig]</a>
<a name="ln85">        int NewSegment([In] long tStart, [In] long tStop, [In] double dRate);</a>
<a name="ln86">    }</a>
<a name="ln87"> </a>
<a name="ln88">    [ComImport, System.Security.SuppressUnmanagedCodeSecurity, Guid(&quot;89c31040-846b-11ce-97d3-00aa0055595a&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln89">    public interface IEnumMediaTypes</a>
<a name="ln90">    {</a>
<a name="ln91">        [PreserveSig]</a>
<a name="ln92">        int Next([In] int cMediaTypes, [In, Out, MarshalAs(UnmanagedType.CustomMarshaler, MarshalTypeRef = typeof(EMTMarshaler), SizeParamIndex = 0)] AmMediaType[] ppMediaTypes, [In] IntPtr pcFetched);</a>
<a name="ln93"> </a>
<a name="ln94">        [PreserveSig]</a>
<a name="ln95">        int Skip([In] int cMediaTypes);</a>
<a name="ln96"> </a>
<a name="ln97">        [PreserveSig]</a>
<a name="ln98">        int Reset();</a>
<a name="ln99"> </a>
<a name="ln100">        [PreserveSig]</a>
<a name="ln101">        int Clone([Out] out IEnumMediaTypes ppEnum);</a>
<a name="ln102">    }</a>
<a name="ln103"> </a>
<a name="ln104">    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]</a>
<a name="ln105">    public struct PinInfo </a>
<a name="ln106">    {</a>
<a name="ln107">        public IBaseFilter filter;</a>
<a name="ln108">        public PinDirection dir;</a>
<a name="ln109"> </a>
<a name="ln110">        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 128)]</a>
<a name="ln111">        public string name;</a>
<a name="ln112">    }</a>
<a name="ln113"> </a>
<a name="ln114">    public enum PinDirection</a>
<a name="ln115">    {</a>
<a name="ln116">        Input,</a>
<a name="ln117">        Output</a>
<a name="ln118">    }</a>
<a name="ln119"> </a>
<a name="ln120">    [ComImport, System.Security.SuppressUnmanagedCodeSecurity, Guid(&quot;0000010c-0000-0000-C000-000000000046&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln121">    public interface IPersist</a>
<a name="ln122">    {</a>
<a name="ln123">        [PreserveSig]</a>
<a name="ln124">        int GetClassID([Out] out Guid pClassID);</a>
<a name="ln125">    }</a>
<a name="ln126"> </a>
<a name="ln127">    [ComImport, System.Security.SuppressUnmanagedCodeSecurity, Guid(&quot;56a86899-0ad4-11ce-b03a-0020af0ba770&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln128">    public interface IMediaFilter : IPersist</a>
<a name="ln129">    {</a>
<a name="ln130">        #region IPersist Methods</a>
<a name="ln131"> </a>
<a name="ln132">        [PreserveSig]</a>
<a name="ln133">        new int GetClassID([Out] out Guid pClassID);</a>
<a name="ln134"> </a>
<a name="ln135">        #endregion</a>
<a name="ln136"> </a>
<a name="ln137">        [PreserveSig]</a>
<a name="ln138">        int Stop();</a>
<a name="ln139"> </a>
<a name="ln140">        [PreserveSig]</a>
<a name="ln141">        int Pause();</a>
<a name="ln142"> </a>
<a name="ln143">        [PreserveSig]</a>
<a name="ln144">        int Run([In] long tStart);</a>
<a name="ln145"> </a>
<a name="ln146">        [PreserveSig]</a>
<a name="ln147">        int GetState([In] int dwMilliSecsTimeout, [Out] out ControlStreaming.FilterState filtState);</a>
<a name="ln148"> </a>
<a name="ln149">        [PreserveSig]</a>
<a name="ln150">        int SetSyncSource([In] IReferenceClock pClock);</a>
<a name="ln151"> </a>
<a name="ln152">        [PreserveSig]</a>
<a name="ln153">        int GetSyncSource([Out] out IReferenceClock pClock);</a>
<a name="ln154">    }</a>
<a name="ln155"> </a>
<a name="ln156">    [ComVisible(true), ComImport, Guid(&quot;56a86895-0ad4-11ce-b03a-0020af0ba770&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln157">    public interface IBaseFilter : IMediaFilter</a>
<a name="ln158">    {</a>
<a name="ln159">        #region IPersist Methods</a>
<a name="ln160">            </a>
<a name="ln161">        [PreserveSig]</a>
<a name="ln162">        new int GetClassID([Out] out Guid pClassID);</a>
<a name="ln163"> </a>
<a name="ln164">        #endregion</a>
<a name="ln165"> </a>
<a name="ln166">        #region IMediaFilter Methods</a>
<a name="ln167"> </a>
<a name="ln168">        [PreserveSig]</a>
<a name="ln169">        new int Stop();</a>
<a name="ln170"> </a>
<a name="ln171">        [PreserveSig]</a>
<a name="ln172">        new int Pause();</a>
<a name="ln173"> </a>
<a name="ln174">        [PreserveSig]</a>
<a name="ln175">        new int Run(long tStart);</a>
<a name="ln176"> </a>
<a name="ln177">        [PreserveSig]</a>
<a name="ln178">        new int GetState([In] int dwMilliSecsTimeout, [Out] out ControlStreaming.FilterState filtState);</a>
<a name="ln179"> </a>
<a name="ln180">        [PreserveSig]</a>
<a name="ln181">        new int SetSyncSource([In] IReferenceClock pClock);</a>
<a name="ln182"> </a>
<a name="ln183">        [PreserveSig]</a>
<a name="ln184">        new int GetSyncSource([Out] out IReferenceClock pClock);</a>
<a name="ln185"> </a>
<a name="ln186">        #endregion</a>
<a name="ln187"> </a>
<a name="ln188">        [PreserveSig]</a>
<a name="ln189">        int EnumPins([Out] out IEnumPins ppEnum);</a>
<a name="ln190"> </a>
<a name="ln191">        [PreserveSig]</a>
<a name="ln192">        int FindPin([In, MarshalAs(UnmanagedType.LPWStr)] string Id, [Out] out IPin ppPin);</a>
<a name="ln193"> </a>
<a name="ln194">        [PreserveSig]</a>
<a name="ln195">        int QueryFilterInfo([Out] FilterInfo pInfo);</a>
<a name="ln196"> </a>
<a name="ln197">        [PreserveSig]</a>
<a name="ln198">        int JoinFilterGraph([In] IFilterGraph pGraph, [In, MarshalAs(UnmanagedType.LPWStr)] string pName);</a>
<a name="ln199"> </a>
<a name="ln200">        [PreserveSig]</a>
<a name="ln201">        int QueryVendorInfo([Out, MarshalAs(UnmanagedType.LPWStr)] out string pVendorInfo);</a>
<a name="ln202">    }</a>
<a name="ln203"> </a>
<a name="ln204">    [ComVisible(true), ComImport, Guid(&quot;56a86897-0ad4-11ce-b03a-0020af0ba770&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln205">    public interface IReferenceClock</a>
<a name="ln206">    {</a>
<a name="ln207">        [PreserveSig]</a>
<a name="ln208">        int GetTime([Out] out long pTime);</a>
<a name="ln209"> </a>
<a name="ln210">        [PreserveSig]</a>
<a name="ln211">        int AdviseTime([In] long baseTime, [In] long streamTime, [In] IntPtr hEvent, [Out] out int pdwAdviseCookie);</a>
<a name="ln212"> </a>
<a name="ln213">        [PreserveSig]</a>
<a name="ln214">        int AdvisePeriodic([In] long startTime, [In] long periodTime, [In] IntPtr hSemaphore, [Out] out int pdwAdviseCookie);</a>
<a name="ln215"> </a>
<a name="ln216">        [PreserveSig]</a>
<a name="ln217">        int Unadvise([In] int dwAdviseCookie);</a>
<a name="ln218">    }</a>
<a name="ln219"> </a>
<a name="ln220">    [ComVisible(true), ComImport, Guid(&quot;56a86892-0ad4-11ce-b03a-0020af0ba770&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln221">    public interface IEnumPins</a>
<a name="ln222">    {</a>
<a name="ln223">        [PreserveSig]</a>
<a name="ln224">        int Next([In] int cPins, [Out, MarshalAs(UnmanagedType.LPArray, SizeParamIndex = 0)] IPin[] ppPins, [Out] out int pcFetched);</a>
<a name="ln225"> </a>
<a name="ln226">        [PreserveSig]</a>
<a name="ln227">        int Skip([In] int cPins);</a>
<a name="ln228"> </a>
<a name="ln229">        void Reset();</a>
<a name="ln230">            </a>
<a name="ln231">        void Clone([Out] out IEnumPins ppEnum);</a>
<a name="ln232">    }</a>
<a name="ln233"> </a>
<a name="ln234">    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]</a>
<a name="ln235">    public class FilterInfo</a>
<a name="ln236">    {</a>
<a name="ln237">        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 128)]</a>
<a name="ln238">        public string achName;</a>
<a name="ln239"> </a>
<a name="ln240">        [MarshalAs(UnmanagedType.IUnknown)]</a>
<a name="ln241">        public object pUnk;</a>
<a name="ln242">    }</a>
<a name="ln243"> </a>
<a name="ln244">    [ComVisible(true), ComImport, Guid(&quot;56a8689f-0ad4-11ce-b03a-0020af0ba770&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln245">    public interface IFilterGraph</a>
<a name="ln246">    {</a>
<a name="ln247">        [PreserveSig]</a>
<a name="ln248">        int AddFilter([In] IBaseFilter pFilter, [In, MarshalAs(UnmanagedType.LPWStr)] string pName);</a>
<a name="ln249"> </a>
<a name="ln250">        [PreserveSig]</a>
<a name="ln251">        int RemoveFilter([In] IBaseFilter pFilter);</a>
<a name="ln252"> </a>
<a name="ln253">        [PreserveSig]</a>
<a name="ln254">        int EnumFilters([Out] out IEnumFilters ppEnum);</a>
<a name="ln255"> </a>
<a name="ln256">        [PreserveSig]</a>
<a name="ln257">        int FindFilterByName([In, MarshalAs(UnmanagedType.LPWStr)] string pName, [Out] out IBaseFilter ppFilter);</a>
<a name="ln258"> </a>
<a name="ln259">        [PreserveSig]</a>
<a name="ln260">        int ConnectDirect([In] IPin ppinOut, [In] IPin ppinIn, [In, MarshalAs(UnmanagedType.LPStruct)] AmMediaType pmt);</a>
<a name="ln261"> </a>
<a name="ln262">        [PreserveSig]</a>
<a name="ln263">        int Reconnect([In] IPin ppin);</a>
<a name="ln264"> </a>
<a name="ln265">        [PreserveSig]</a>
<a name="ln266">        int Disconnect([In] IPin ppin);</a>
<a name="ln267"> </a>
<a name="ln268">        [PreserveSig]</a>
<a name="ln269">        int SetDefaultSyncSource();</a>
<a name="ln270">    }</a>
<a name="ln271"> </a>
<a name="ln272">    [ComVisible(true), ComImport, Guid(&quot;56a86893-0ad4-11ce-b03a-0020af0ba770&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln273">    public interface IEnumFilters</a>
<a name="ln274">    {</a>
<a name="ln275">        [PreserveSig]</a>
<a name="ln276">        int Next([In] uint cFilters, out IBaseFilter x, [Out] out uint pcFetched);</a>
<a name="ln277"> </a>
<a name="ln278">        [PreserveSig]</a>
<a name="ln279">        int Skip([In] int cFilters);</a>
<a name="ln280"> </a>
<a name="ln281">        void Reset();</a>
<a name="ln282">            </a>
<a name="ln283">        void Clone([Out] out IEnumFilters ppEnum);</a>
<a name="ln284">    }</a>
<a name="ln285"> </a>
<a name="ln286">    /// &lt;summary&gt;</a>
<a name="ln287">    /// From AM_MEDIA_TYPE - When you are done with an instance of this class,</a>
<a name="ln288">    /// it should be released with FreeAMMediaType() to avoid leaking</a>
<a name="ln289">    /// &lt;/summary&gt;</a>
<a name="ln290">    [StructLayout(LayoutKind.Sequential), ComVisible(false)]</a>
<a name="ln291">    public class AmMediaType</a>
<a name="ln292">    {</a>
<a name="ln293">        public Guid majorType;</a>
<a name="ln294"> </a>
<a name="ln295">        public Guid subType;</a>
<a name="ln296">            </a>
<a name="ln297">        [MarshalAs(UnmanagedType.Bool)]</a>
<a name="ln298">            </a>
<a name="ln299">        public bool fixedSizeSamples;</a>
<a name="ln300">            </a>
<a name="ln301">        [MarshalAs(UnmanagedType.Bool)]</a>
<a name="ln302">        public bool temporalCompression;</a>
<a name="ln303">            </a>
<a name="ln304">        public int sampleSize;</a>
<a name="ln305">            </a>
<a name="ln306">        public Guid formatType;</a>
<a name="ln307">            </a>
<a name="ln308">        public IntPtr unkPtr;</a>
<a name="ln309">            </a>
<a name="ln310">        public int formatSize;</a>
<a name="ln311">            </a>
<a name="ln312">        public IntPtr formatPtr;</a>
<a name="ln313">    }</a>
<a name="ln314"> </a>
<a name="ln315">    [ComVisible(true), ComImport, Guid(&quot;56a8689a-0ad4-11ce-b03a-0020af0ba770&quot;), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]</a>
<a name="ln316">    public interface IMediaSample</a>
<a name="ln317">    {</a>
<a name="ln318">        [PreserveSig]</a>
<a name="ln319">        int GetPointer([Out] out IntPtr ppBuffer);</a>
<a name="ln320"> </a>
<a name="ln321">        [PreserveSig]</a>
<a name="ln322">        int GetSize();</a>
<a name="ln323"> </a>
<a name="ln324">        [PreserveSig]</a>
<a name="ln325">        int GetTime([Out] out long pTimeStart, [Out] out long pTimeEnd);</a>
<a name="ln326"> </a>
<a name="ln327">        [PreserveSig]</a>
<a name="ln328">        int SetTime([In, MarshalAs(UnmanagedType.LPStruct)] Util.DsOptInt64 pTimeStart, [In, MarshalAs(UnmanagedType.LPStruct)] Util.DsOptInt64 pTimeEnd);</a>
<a name="ln329"> </a>
<a name="ln330">        [PreserveSig]</a>
<a name="ln331">        int IsSyncPoint();</a>
<a name="ln332"> </a>
<a name="ln333">        [PreserveSig]</a>
<a name="ln334">        int SetSyncPoint([In, MarshalAs(UnmanagedType.Bool)] bool bIsSyncPoint);</a>
<a name="ln335"> </a>
<a name="ln336">        [PreserveSig]</a>
<a name="ln337">        int IsPreroll();</a>
<a name="ln338"> </a>
<a name="ln339">        [PreserveSig]</a>
<a name="ln340">        int SetPreroll([In, MarshalAs(UnmanagedType.Bool)] bool bIsPreroll);</a>
<a name="ln341"> </a>
<a name="ln342">        [PreserveSig]</a>
<a name="ln343">        int GetActualDataLength();</a>
<a name="ln344"> </a>
<a name="ln345">        [PreserveSig]</a>
<a name="ln346">        int SetActualDataLength([In] int len);</a>
<a name="ln347"> </a>
<a name="ln348">        /// &lt;summary&gt;</a>
<a name="ln349">        /// Returned object must be released with DsUtils.FreeAMMediaType()</a>
<a name="ln350">        /// &lt;/summary&gt;</a>
<a name="ln351">        [PreserveSig]</a>
<a name="ln352">        int GetMediaType([Out, MarshalAs(UnmanagedType.LPStruct)] out AmMediaType ppMediaType);</a>
<a name="ln353"> </a>
<a name="ln354">        [PreserveSig]</a>
<a name="ln355">        int SetMediaType([In, MarshalAs(UnmanagedType.LPStruct)] AmMediaType pMediaType);</a>
<a name="ln356"> </a>
<a name="ln357">        [PreserveSig]</a>
<a name="ln358">        int IsDiscontinuity();</a>
<a name="ln359"> </a>
<a name="ln360">        [PreserveSig]</a>
<a name="ln361">        int SetDiscontinuity([In, MarshalAs(UnmanagedType.Bool)] bool bDiscontinuity);</a>
<a name="ln362"> </a>
<a name="ln363">        [PreserveSig]</a>
<a name="ln364">        int GetMediaTime([Out] out long pTimeStart, [Out] out long pTimeEnd);</a>
<a name="ln365"> </a>
<a name="ln366">        [PreserveSig]</a>
<a name="ln367">        int SetMediaTime([In, MarshalAs(UnmanagedType.LPStruct)] Util.DsOptInt64 pTimeStart, [In, MarshalAs(UnmanagedType.LPStruct)] Util.DsOptInt64 pTimeEnd);</a>
<a name="ln368">    }</a>
<a name="ln369"> </a>
<a name="ln370">    [ComVisible(false)]</a>
<a name="ln371">    public class DsHlp</a>
<a name="ln372">    {</a>
<a name="ln373">        public const int OATRUE = -1;</a>
<a name="ln374">        public const int OAFALSE = 0;</a>
<a name="ln375"> </a>
<a name="ln376">        [DllImport(&quot;quartz.dll&quot;, CharSet = CharSet.Unicode, ExactSpelling = true, EntryPoint = &quot;AMGetErrorTextW&quot;), SuppressUnmanagedCodeSecurity]</a>
<a name="ln377">        private static extern int AMGetErrorText(int hr, StringBuilder buf, int max);</a>
<a name="ln378">    }</a>
<a name="ln379">}</a>
</code></pre>
<div class="balloon" rel="16"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v3144/" target="_blank">V3144</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>
<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>